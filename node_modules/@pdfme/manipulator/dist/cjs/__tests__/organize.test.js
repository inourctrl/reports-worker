"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const index_1 = require("../src/index");
const test_helpers_1 = require("./test-helpers");
describe('organize', () => {
    test('performs single remove operation', async () => {
        const pdf = await (0, test_helpers_1.createTestPDF)(5);
        const result = await (0, index_1.organize)(pdf, [
            { type: 'remove', data: { position: 1 } },
            { type: 'remove', data: { position: 3 } },
        ]);
        expect(await (0, test_helpers_1.getPDFPageCount)(result)).toBe(3);
    });
    test('performs single insert operation', async () => {
        const pdf = await (0, test_helpers_1.createTestPDF)(3);
        const insertPdf = await (0, test_helpers_1.createTestPDF)(2);
        const result = await (0, index_1.organize)(pdf, [{ type: 'insert', data: { pdf: insertPdf, position: 1 } }]);
        expect(await (0, test_helpers_1.getPDFPageCount)(result)).toBe(5);
    });
    test('performs single replace operation', async () => {
        const pdf = await (0, test_helpers_1.createTestPDF)(3);
        const replacePdf = await (0, test_helpers_1.createTestPDF)(1);
        const result = await (0, index_1.organize)(pdf, [
            { type: 'replace', data: { position: 1, pdf: replacePdf } },
        ]);
        expect(await (0, test_helpers_1.getPDFPageCount)(result)).toBe(3);
    });
    test('performs single rotate operation', async () => {
        const pdf = await (0, test_helpers_1.createTestPDF)(3);
        const result = await (0, index_1.organize)(pdf, [
            { type: 'rotate', data: { position: 0, degrees: 90 } },
            { type: 'rotate', data: { position: 2, degrees: 90 } },
        ]);
        expect(await (0, test_helpers_1.getPDFPageCount)(result)).toBe(3);
    });
    test('performs multiple operations in sequence', async () => {
        const pdf = await (0, test_helpers_1.createTestPDF)(5);
        const insertPdf = await (0, test_helpers_1.createTestPDF)(2);
        const replacePdf = await (0, test_helpers_1.createTestPDF)(1);
        const result = await (0, index_1.organize)(pdf, [
            { type: 'remove', data: { position: 1 } },
            { type: 'remove', data: { position: 3 } }, // 5 -> 3 pages
            { type: 'insert', data: { pdf: insertPdf, position: 1 } }, // 3 -> 5 pages
            { type: 'replace', data: { position: 2, pdf: replacePdf } }, // Still 5 pages
            { type: 'rotate', data: { position: 0, degrees: 90 } },
            { type: 'rotate', data: { position: 3, degrees: 90 } }, // Still 5 pages
        ]);
        expect(await (0, test_helpers_1.getPDFPageCount)(result)).toBe(5);
    });
    test('throws error for invalid page numbers', async () => {
        const pdf = await (0, test_helpers_1.createTestPDF)(3);
        await expect((0, index_1.organize)(pdf, [{ type: 'remove', data: { position: 3 } }])).rejects.toThrow('[@pdfme/manipulator] Invalid page number');
    });
    test('throws error for invalid position', async () => {
        const pdf = await (0, test_helpers_1.createTestPDF)(3);
        const insertPdf = await (0, test_helpers_1.createTestPDF)(1);
        await expect((0, index_1.organize)(pdf, [{ type: 'insert', data: { pdf: insertPdf, position: 4 } }])).rejects.toThrow('[@pdfme/manipulator] Invalid position');
    });
    test('throws error for invalid rotation degrees', async () => {
        const pdf = await (0, test_helpers_1.createTestPDF)(3);
        await expect(
        // @ts-expect-error
        (0, index_1.organize)(pdf, [{ type: 'rotate', data: { pages: [0], degrees: 45 } }])).rejects.toThrow('[@pdfme/manipulator] Rotation degrees must be a multiple of 90');
    });
    test('throws error for empty actions array', async () => {
        const pdf = await (0, test_helpers_1.createTestPDF)(3);
        await expect((0, index_1.organize)(pdf, [])).rejects.toThrow('[@pdfme/manipulator] At least one action is required');
    });
    test('throws error for unknown action type', async () => {
        const pdf = await (0, test_helpers_1.createTestPDF)(3);
        // @ts-expect-error
        await expect((0, index_1.organize)(pdf, [{ type: 'invalid', data: { pages: [] } }])).rejects.toThrow('[@pdfme/manipulator] Unknown action type: invalid');
    });
});
//# sourceMappingURL=organize.test.js.map